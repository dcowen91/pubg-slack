{"version":3,"file":"SlackAdapter.js","sourceRoot":"","sources":["../../src/Models/SlackAdapter.ts"],"names":[],"mappings":";;AAAA,0CAAoD;AAIpD;IASC,YAAY,MAAiB,EAAE,QAAkB,EAAE,cAA8B;QANzE,cAAS,GAAW,cAAc,CAAC;QAQ1C,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzB,IAAI,CAAC,cAAc,GAAG,cAAc,CAAC;IACtC,CAAC;IACD,KAAK;QAEJ,OAAO,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;QAC7B,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,mBAAU,CAAC,OAAO,EAAE,CAAC,OAAO;YAC1C,MAAM,WAAW,GAAa,CAAC,CAAC,OAAO,CAAC,IAAI,GAAG,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC;YAC5E,MAAM,cAAc,GAAG,WAAW,CAAC,CAAC,CAAC,KAAK,IAAI,CAAC,SAAS,CAAC;YAEzD,EAAE,CAAC,CAAC,cAAc,IAAI,IAAI,CAAC,cAAc,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,CAEzE,CAAC;gBACA,MAAM,OAAO,GAAG,WAAW,CAAC,CAAC,CAAC,CAAC;gBAC/B,MAAM,MAAM,GAAG,WAAW,CAAC,CAAC,CAAC,IAAI,IAAI,GAAG,OAAO,CAAC,IAAI,GAAG,GAAG,CAAC;gBAE3D,EAAE,CAAC,CAAC,CAAC,OAAO,IAAI,OAAO,CAAC,WAAW,EAAE,KAAK,MAAM,CAAC,CACjD,CAAC;oBACA,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,kIAAkI,EAAE,OAAO,CAAC,OAAO,CAAC,CAAC;gBAC9K,CAAC;gBACD,IAAI,CAAC,EAAE,CAAC,CAAC,OAAO,CAAC,WAAW,EAAE,KAAK,SAAS,CAAC,CAC7C,CAAC;oBACA,EAAE,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CACpB,CAAC;wBACA,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,oDAAoD,EAAE,OAAO,CAAC,OAAO,CAAC,CAAC;oBAChG,CAAC;oBACD,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,IAAI,GAAG,OAAO,CAAC,IAAI,GAAG,GAAG,EAAE,MAAM,CAAC,CAAC;oBACzD,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,aAAa,EAAE,OAAO,CAAC,OAAO,CAAC,CAAC;oBACxD,MAAM,CAAC;gBACR,CAAC;gBACD,IAAI,CACJ,CAAC;oBACA,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,MAAM,CAAC;oBACzD,OAAO,CAAC,GAAG,CAAC,eAAe,GAAG,QAAQ,CAAC,CAAC;oBACxC,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC,IAAI,CAAC,CAAC,MAAM;wBAChE,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,MAAM,EAAE,OAAO,CAAC,OAAO,CAAC,CAAC;oBAClD,CAAC,CAAC,CAAC;gBACJ,CAAC;YACF,CAAC;YACD,IAAI,CACJ,CAAC;gBACA,OAAO,CAAC,GAAG,CAAC,OAAO,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;YACrC,CAAC;QACF,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC;IACrB,CAAC;CACD;AACD,kBAAe,YAAY,CAAC","sourcesContent":["import {RtmClient, RTM_EVENTS} from '@slack/client';\r\nimport UsersMap from './UsersMap';\r\nimport CommandAdapter from './CommandAdapter';\r\n\r\nclass SlackAdapter\r\n{\r\n\t// TODO don't hard code this\r\n\tprivate botUserid: string = '<@U5Z8ER1DG>';\r\n\r\n\tclient: RtmClient;\r\n\tusersMap: UsersMap;\r\n\tcommandAdapter: CommandAdapter;\r\n\r\n\tconstructor(client: RtmClient, usersMap: UsersMap, commandAdapter: CommandAdapter)\r\n\t{\r\n\t\tthis.client = client;\r\n\t\tthis.usersMap = usersMap;\r\n\t\tthis.commandAdapter = commandAdapter;\r\n\t}\r\n\tstart()\r\n\t{\r\n\t\tconsole.log('now listening');\r\n\t\tthis.client.on(RTM_EVENTS.MESSAGE, (message) =>  {\r\n\t\t\tconst messageText: string[] = !!message.text ? message.text.split(' ') : [];\r\n\t\t\tconst isMessageToBot = messageText[0] === this.botUserid;\r\n\t\t\t// TODO do more / proper validation here\r\n\t\t\tif (isMessageToBot && this.commandAdapter.isValidCommand(messageText[1]))\r\n\t\t\t// if (messageText[0] === this.botUserid && messageText.length <= 3)\r\n\t\t\t{\r\n\t\t\t\tconst command = messageText[1];\r\n\t\t\t\tconst target = messageText[2] || '<@' + message.user + '>';\r\n\r\n\t\t\t\tif (!command || command.toLowerCase() === 'help')\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.client.sendMessage('USAGE:\\n@pubgstatsbot help\\n@pubgstatsbot adduser [your_pubg_nickName]\\n@pubgstatsbot [stats|kdr|rating|wins|top10] [@SlackUser]', message.channel);\r\n\t\t\t\t}\r\n\t\t\t\telse if (command.toLowerCase() === 'adduser')\r\n\t\t\t\t{\r\n\t\t\t\t\tif (!messageText[2])\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.client.sendMessage('USAGE:\\n@pubgstatsbot adduser [your_pubg_nickName]', message.channel);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.usersMap.addUser('<@' + message.user + '>', target);\r\n\t\t\t\t\tthis.client.sendMessage('user added!', message.channel);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tconst userName = this.usersMap.getUser(target) || target;\r\n\t\t\t\t\tconsole.log('querying for ' + userName);\r\n\t\t\t\t\tthis.commandAdapter.handleCommand(userName, command).then((result) => {\r\n\t\t\t\t\t\tthis.client.sendMessage(result, message.channel);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tconsole.log('dafuq' + message.text);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.client.start();\r\n\t}\r\n}\r\nexport default SlackAdapter;"]}
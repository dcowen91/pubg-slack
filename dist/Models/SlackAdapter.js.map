{"version":3,"file":"SlackAdapter.js","sourceRoot":"","sources":["../../src/Models/SlackAdapter.ts"],"names":[],"mappings":"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","sourcesContent":["import {RtmClient, RTM_EVENTS} from '@slack/client';\r\nimport UsersMap from './UsersMap';\r\nimport CommandAdapter from './CommandAdapter';\r\n\r\nclass SlackAdapter\r\n{\r\n\tprivate botUserid: string = '<@U5Z8ER1DG>';\r\n\r\n\tclient: RtmClient;\r\n\tusersMap: UsersMap;\r\n\tcommandAdapter: CommandAdapter;\r\n\r\n\tconstructor(client: RtmClient, usersMap: UsersMap, commandAdapter: CommandAdapter)\r\n\t{\r\n\t\tthis.client = client;\r\n\t\tthis.usersMap = usersMap;\r\n\t\tthis.commandAdapter = commandAdapter;\r\n\t}\r\n\tstart(func: (a: string, b: string) => void)\r\n\t{\r\n\t\tthis.client.on(RTM_EVENTS.MESSAGE, (message) =>  {\r\n\t\t\tconst messageText: string[] = !!message.text ? message.text.split(' ') : [];\r\n\t\t\t// console.log(message);\r\n\t\t\tconsole.log(messageText);\r\n\t\t\tif (messageText[0] === this.botUserid && messageText.length <= 3)\r\n\t\t\t{\r\n\t\t\t\tconst command = messageText[1];\r\n\t\t\t\tconst target = messageText[2] || '<@' + message.user + '>';\r\n\r\n\t\t\t\tconsole.log('command: ' + command);\r\n\t\t\t\tconsole.log('user: ' + target);\r\n\t\t\t\tif (!command || command.toLowerCase() === 'help')\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.client.sendMessage('USAGE:\\n@pubgstatsbot help\\n@pubgstatsbot adduser [your_pubg_nickName]\\n@pubgstatsbot [stats|kdr|rating|wins|top10] [@SlackUser]', message.channel);\r\n\t\t\t\t}\r\n\t\t\t\telse if (command.toLowerCase() === 'adduser')\r\n\t\t\t\t{\r\n\t\t\t\t\tif (!messageText[2])\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.client.sendMessage('USAGE:\\n@pubgstatsbot adduser [your_pubg_nickName]', message.channel);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.usersMap.addUser('<@' + message.user + '>', target);\r\n\t\t\t\t\tthis.client.sendMessage('user added!', message.channel);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tconst userName = this.usersMap.getUser(target);\r\n\t\t\t\t\tif (!userName)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.client.sendMessage('pubg user not found for ' + target + '. Please have the user call the addUser command', message.channel);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconsole.log('querying for ' + userName);\r\n\t\t\t\t\t\tthis.commandAdapter.handleCommand(userName, command).then((result) => {\r\n\t\t\t\t\t\t\tconsole.log(result);\r\n\t\t\t\t\t\t\tthis.client.sendMessage(result, message.channel);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// func(target, command);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// TODO remove this\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tconsole.log(func);\r\n\t\t\t}\r\n\t\t\t// TODO call func and also actually parse this into a playername and a command\r\n\t\t});\r\n\r\n\t\tthis.client.start();\r\n\t\tconsole.log('now running');\r\n\t\t// TODO call func\r\n\t}\r\n\r\n\tpromptForUserName(): string\r\n\t{\r\n\t\treturn 'gettingName';\r\n\t}\r\n}\r\nexport default SlackAdapter;"]}
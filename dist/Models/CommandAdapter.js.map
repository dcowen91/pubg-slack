{"version":3,"file":"CommandAdapter.js","sourceRoot":"","sources":["../../src/Models/CommandAdapter.ts"],"names":[],"mappings":"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","sourcesContent":["import {PubgAPI} from 'pubg-api-redis';\r\nimport {PlayerStats} from '../Interfaces/PlayerStats';\r\nimport {StatName} from '../Enums/StatName';\r\nimport PlayerStatsCache from './PlayerStatsCache';\r\nimport PlayerStatsAdapter from './PlayerStatsAdapter';\r\n\r\nclass CommandAdapter\r\n{\r\n\tprivate commandNames: string[] = [\r\n\t\t'rating',\r\n\t\t'kdr',\r\n\t\t'wins',\r\n\t\t'top10s',\r\n\t\t'bestrating',\r\n\t\t'teamwork',\r\n\t\t'vehicle',\r\n\t\t'records',\r\n\t\t'timealive',\r\n\t\t'distance',\r\n\t\t'headshot',\r\n\t\t'health',\r\n\t\t'random',\r\n\t\t'details',\r\n\t\t'adduser',\r\n\t\t'help'\r\n\t];\r\n\r\n\tprivate api: PubgAPI;\r\n\tprivate playerCache: PlayerStatsCache;\r\n\r\n\tconstructor(api: PubgAPI, playerCache: PlayerStatsCache)\r\n\t{\r\n\t\tthis.api = api;\r\n\t\tthis.playerCache = playerCache;\r\n\t}\r\n\r\n\tisValidCommand(commandText: string): Boolean\r\n\t{\r\n\t\treturn this.commandNames.indexOf(commandText.toLocaleLowerCase()) >= 0;\r\n\t}\r\n\r\n\thandleCommand(userName: string, commandText: string): Promise<string>\r\n\t{\r\n\t\treturn this.getPlayerStats(userName).then((playerStats: PlayerStats) => {\r\n\t\t\tconst adapter = new PlayerStatsAdapter(playerStats);\r\n\t\t\treturn this.getCommandText(commandText.toLocaleLowerCase(), adapter);\r\n\t\t}, () => {\r\n\t\t\treturn 'failed to find user ' + userName;\r\n\t\t});\r\n\t}\r\n\r\n\tprivate getPlayerStats(userName): Promise<PlayerStats>\r\n\t{\r\n\t\tconst cachedValue = this.playerCache.getPlayer(userName).stats;\r\n\t\tif (!!cachedValue)\r\n\t\t{\r\n\t\t\treturn Promise.resolve(cachedValue);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\treturn this.api.profile.byNickname(userName).then((playerStats: PlayerStats) => {\r\n\t\t\t\tthis.playerCache.addPlayer(userName, playerStats);\r\n\t\t\t\treturn playerStats;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tprivate getCommandText(commandText: string, adapter: PlayerStatsAdapter)\r\n\t{\r\n\t\tswitch (commandText) {\r\n\t\t\tcase this.commandNames[0]:\r\n\t\t\t{\r\n\t\t\t\treturn adapter.printStats([StatName.Rating,  StatName.RoundsPlayed]);\r\n\t\t\t}\r\n\t\t\tcase this.commandNames[1]:\r\n\t\t\t{\r\n\t\t\t\treturn adapter.printStats([StatName.KillDeathRatio, StatName.DamagePg]);\r\n\t\t\t}\r\n\t\t\tcase this.commandNames[2]:\r\n\t\t\t{\r\n\t\t\t\treturn adapter.printStats([StatName.Wins, StatName.WinRatio]);\r\n\t\t\t}\r\n\t\t\tcase this.commandNames[3]:\r\n\t\t\t{\r\n\t\t\t\treturn adapter.printStats([StatName.Top10s, StatName.Top10Ratio]);\r\n\t\t\t}\r\n\t\t\tcase this.commandNames[4]:\r\n\t\t\t{\r\n\t\t\t\treturn adapter.printStats([StatName. BestRating, StatName.BestRank]);\r\n\t\t\t}\r\n\t\t\tcase this.commandNames[5]:\r\n\t\t\t{\r\n\t\t\t\treturn adapter.printStats([StatName.TeamKills, StatName.Suicides]);\r\n\t\t\t}\r\n\t\t\tcase this.commandNames[6]:\r\n\t\t\t{\r\n\t\t\t\treturn adapter.printStats([StatName.RoadKills, StatName.VehicleDestroys]);\r\n\t\t\t}\r\n\t\t\tcase this.commandNames[7]:\r\n\t\t\t{\r\n\t\t\t\treturn adapter.printStats([StatName.RoundMostKills, StatName.LongestKill]);\r\n\t\t\t}\r\n\t\t\tcase this.commandNames[8]:\r\n\t\t\t{\r\n\t\t\t\treturn adapter.printStats([StatName.LongestTimeSurvived, StatName.AvgSurvivalTime]);\r\n\t\t\t}\r\n\t\t\tcase this.commandNames[9]:\r\n\t\t\t{\r\n\t\t\t\treturn adapter.printStats([StatName.MoveDistancePg, StatName.AvgRideDistance]);\r\n\t\t\t}\r\n\t\t\tcase this.commandNames[10]:\r\n\t\t\t{\r\n\t\t\t\treturn adapter.printStats([StatName.HeadshotKillRatio, StatName.HeadshotKillsPg]);\r\n\t\t\t}\r\n\t\t\tcase this.commandNames[11]:\r\n\t\t\t{\r\n\t\t\t\treturn adapter.printStats([StatName.RevivesPg, StatName.HealsPg]);\r\n\t\t\t}\r\n\t\t\tcase this.commandNames[12]:\r\n\t\t\t{\r\n\t\t\t\t// 12 is the # of valid individual commands (index of the previous case)\r\n\t\t\t\tconst randomStat = Math.floor(Math.random() * 12);\r\n\t\t\t\treturn this.getCommandText(this.commandNames[randomStat], adapter);\r\n\t\t\t}\r\n\t\t\tcase this.commandNames[13]:\r\n\t\t\t{\r\n\t\t\t\treturn  adapter.printStats([StatName.Rating, StatName.RoundsPlayed, StatName.Wins, StatName.Top10s, StatName.KillDeathRatio]);\r\n\t\t\t}\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn 'not supported ' + commandText;\r\n\t}\r\n}\r\n\r\nexport default CommandAdapter;"]}
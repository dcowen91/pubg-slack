{"version":3,"file":"SlackAdapter.js","sourceRoot":"","sources":["../../src/Controllers/SlackAdapter.ts"],"names":[],"mappings":"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","sourcesContent":["import { RtmClient, RTM_EVENTS } from '@slack/client';\r\nimport UsersMap from './UsersMap';\r\nimport CommandHandler from './CommandHandler';\r\n\r\nclass SlackAdapter\r\n{\r\n\t// TODO don't hard code this\r\n\t// private botUserid: string = '<@U5Z8ER1DG>';\r\n\r\n\tclient: RtmClient;\r\n\tusersMap: UsersMap;\r\n\tcommandHandler: CommandHandler;\r\n\r\n\tconstructor(client: RtmClient, usersMap: UsersMap, commandHandler: CommandHandler)\r\n\t{\r\n\t\tthis.client = client;\r\n\t\tthis.usersMap = usersMap;\r\n\t\tthis.commandHandler = commandHandler;\r\n\t}\r\n\tstart()\r\n\t{\r\n\t\tconsole.log('now listening');\r\n\t\tthis.client.on(RTM_EVENTS.MESSAGE, (message) =>  {\r\n\t\t\tconst messageText: string[] = !!message.text ? message.text.split(' ') : [];\r\n\t\t\tconst isMessageToBot = messageText[0] === this.client.botUserid;\r\n\t\t\tif (isMessageToBot && this.commandHandler.isValidCommand(messageText[1]))\r\n\t\t\t{\r\n\t\t\t\tconst command = messageText[1];\r\n\t\t\t\tconst target = messageText[2];\r\n\r\n\t\t\t\tif (!command || command.toLowerCase() === 'help')\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.client.sendMessage(`Usage:\r\n\\`@pubgstatsbot [command] [pubg_nickname]\\`\r\n\tIf you have trouble remembering someone's PUBG nickname, use the addUser command:\r\n\r\n\\`@pubgstatsbot addUser [@SlackUser] [pubg_nickname]\\`\r\n\\`@pubgstatsbot [command] [@SlackUser]\\`\r\n\r\nCommands:\r\n\\`rating, kdr, wins, top10s, bestrating, teamwork, vehicle, records, timealive, distance, headshot, health, details, random, help\\``, message.channel);\r\n\t\t\t\t}\r\n\t\t\t\telse if (command.toLowerCase() === 'adduser')\r\n\t\t\t\t{\r\n\t\t\t\t\tif (!messageText[2] || !messageText[3])\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.client.sendMessage('USAGE:\\n@pubgstatsbot adduser [@SlackUser] [pubg_nickname]', message.channel);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst nickName = messageText[3];\r\n\t\t\t\t\t\tthis.usersMap.addUser( target, nickName);\r\n\t\t\t\t\t\tthis.client.sendMessage('user added!', message.channel);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse if (!messageText[2])\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.client.sendMessage('USAGE:\\n@pubgstatsbot [command] [pubg_nickname]', message.channel);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tconst userName = this.usersMap.getUser(target) || target || '<@' + message.user + '>';\r\n\t\t\t\t\tthis.commandHandler.handleCommand(userName, command).then((result) => {\r\n\t\t\t\t\t\tthis.client.sendMessage(result, message.channel);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (isMessageToBot)\r\n\t\t\t{\r\n\t\t\t\tthis.client.sendMessage('Usage:\\n`@pubgstatsbot [command] [pubg_nickname]`\\n`@pubgstatsbot help` to learn more', message.channel);\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.client.start();\r\n\t}\r\n}\r\nexport default SlackAdapter;"]}